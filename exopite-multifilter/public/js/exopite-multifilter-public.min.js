!function(e,i,t,o){"use strict";e.fn.exopiteMultifilter=function(o){var n={loadingFinishedText:"No More Posts Available"},a=function(i,t){return t.each(function(t,o){var n=e(o).data("taxonomy");i[n]={};var a=[];e(o).find(".active").each(function(i,t){a.push(e(t).data("term"))}),i[n]=a}),i},s=function(e){var i=e.attr("href"),t=/pages?\/(\d+)/g.exec(i);return t?t[1]:1},r=function(){var e={};return i.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(i,t,o){e[t]=o}),e},l=function(e,i,t,o,n){switch(i){case"out":e.stop(!0,!1).slideUp(500).css({opacity:0,transition:"opacity .5s"});break;case"in":e.stop(!0,!1).css({opacity:1,transition:"opacity .5s",height:"auto"}).slideDown(500).promise().then(function(){t&&void 0!==wp.hooks&&wp.hooks.doAction("ema-success-animation-end",o,n)})}},c=e.proxy(function(){return this.selector},this);return this.each(function(d,p){var f,u=p,h=(e.extend({},n,o),{filterItems:e(u).find(".exopite-multifilter-filter-item"),nowLoading:e(u).find(".exopite-multifilter-now-loading"),taxonomies:e(u).find(".exopite-multifilter-filter-taxonomy"),searchButton:e(u).find(".exopite-multifilter-filter-reset-search").find('button[type="submit"]'),searchField:e(u).find(".exopite-multifilter-filter-reset-search").find("form").find("input"),reset:e(u).find(".exopite-multifilter-filter-reset"),itemsContainer:e(u).find(".exopite-multifilter-items"),pagination:e(u).find(".exopite-multifilter-paginations"),loading:e(u).find(".exopite-multifilter-now-loading")}),m=!1,g=!1,v=1,x="",w=function(t,o){if(u===t&&"pagination"==o.pagination){var n=e(t).offset().top;if(!(n-e(i).scrollTop()>0))return e("#wpadminbar").length&&(n-=e("#wpadminbar").height()),n-=e("header nav").height(),e("html, body").animate({scrollTop:n},300),t}},k=function(){if(f.display_filter){var t={};f.taxonomies_terms=a(t,h.taxonomies)}h.searchField.length&&(f.search=x),f.paged=v,f.store_session&&localStorage.setItem(c()+d,JSON.stringify({taxonomies_terms:f.taxonomies_terms,paged:v,search:x})),e.ajax({cache:!1,type:"POST",url:wp_ajax.ajax_url,data:{action:"exopite_multifilter_get_posts",json:JSON.stringify(f)},beforeSend:function(){m=!0,void 0!==wp.hooks&&wp.hooks.doAction("ema-before-send",u,f),"pagination"!=f.pagination&&1!=v||l(h.itemsContainer,"out",!1,null,null),"infinite"!=f.pagination&&l(h.pagination,"out",!1,null,null),l(h.loading,"in",!1,null,null)},success:function(t){void 0!==wp.hooks&&wp.hooks.doAction("ema-success-top",u,f),l(h.loading,"out",!1,null,null);var o=e(t),n=o.find("article"),a=o.filter(".no-posts-found");if(n.length>0){var s=o.filter(".exopite-multifilter-paginations").children(":first"),r=h.itemsContainer.data("page")+"page/"+v+"/";"pagination"==f.pagination||1==v?(h.itemsContainer.html(n),"masonry"==f.style?e(h.itemsContainer).css({opacity:1,height:"auto",display:"flex"}):l(h.itemsContainer,"in"),void 0!==wp.hooks&&wp.hooks.doAction("ema-success-items-paginated",u,n),e(u).trigger("success-items-paginated.exopiteMultifilter",[u,n])):(f.display_page_number?n=e('<div class="page-number" data-page="'+r+'">'+v+"</div>").add(n):f.update_paged&&n.filter("article").first().attr("data-page",r),h.itemsContainer.append(n),void 0!==wp.hooks&&wp.hooks.doAction("ema-success-items-appended",u,n),e(u).trigger("success-items-appended.exopiteMultifilter",[u,n])),void 0!==wp.hooks&&wp.hooks.doAction("ema-success",u,n),e(u).trigger("success-ajax.exopiteMultifilter",[u,n]),f.update_paged&&r!=i.location&&changeBrowserUrl(r),"infinite"!=f.pagination&&(h.pagination.html(s),l(h.pagination,"in",!0,u,f))}else"pagination"!=f.pagination&&1!=v||h.itemsContainer.empty(),h.pagination.html(a),l(h.itemsContainer,"in",!1,null,null),l(h.pagination,"in",!1,null,null),g=!0,setTimeout(function(){h.pagination.fadeOut("fast")},3e3);e(u).find(".nothing-more").length&&setTimeout(function(){h.pagination.fadeOut("fast")},3e3),void 0!==wp.hooks&&wp.hooks.doAction("ema-success-end",u,f),m=!1},error:function(e,i,t){void 0!==wp.hooks&&wp.hooks.doAction("ema-error",u),console.log("Error: "+e.responseText),console.log("Error: "+e),console.log("Error: "+i),console.log("Error: "+t),m=!1}})},y=function(){!m&&!g&&"infinite"==f.pagination&&e(i).scrollTop()>=e(h.itemsContainer).children().last().offset().top+e(h.itemsContainer).children().last().outerHeight()-i.innerHeight&&(v++,void 0!==wp.hooks&&wp.hooks.doAction("ema-bottom-reached",u),k())},_=Exopite.throttle(function(){"infinite"==f.pagination&&y(),f.update_paged&&e("[data-page]").each(function(t,o){var n=e(o).data("page");if(isElementInViewport(o)){if(i.location.href==n)return;changeBrowserUrl(n)}})},100);e(t).on("scroll",_);var b=function(e){switch(g=!1,v=1,x="","search"!=e&&h.searchField.val(""),e){case"search":x=h.searchField.val();case"reset":h.filterItems.removeClass("active")}};h.searchButton.on("click",function(e){e.preventDefault(),m||""!==h.searchField.val()&&(b("search"),void 0!==wp.hooks&&wp.hooks.doAction("ema-search",u,h.searchField.val()),k())}),h.reset.on("click",function(e){e.preventDefault(),m||(b("reset"),void 0!==wp.hooks&&wp.hooks.doAction("ema-reset",u),k())}),h.filterItems.on("click",function(i){if(i.preventDefault(),!m){if(void 0!==wp.hooks&&wp.hooks.doAction("ema-filter-selected",u),f.multi_selectable)b(),e(this).toggleClass("active");else{var t=e(this).hasClass("active");b("reset"),t||e(this).addClass("active")}k()}}),h.pagination.on("click",".page-numbers, .btn-readmore",function(i){i.preventDefault(),m||(v=s(e(this)),void 0!==wp.hooks&&wp.hooks.doAction("ema-pagination",u),k())}),f=e(u).data("ajax"),e(u).attr("data-index",d),void 0!==wp.hooks&&wp.hooks.addAction("ema-before-send",w,10);var A=function(e,i,t){var o=new RegExp("(\\?|\\&)("+i+"=).*?(&|$)"),n=e;return n=e.search(o)>=0?e.replace(o,"$1$2"+t+"$3"):n+(n.indexOf("?")>0?"&":"?")+i+"="+t};(f.store_session||f.load_from_url)&&function(){var t=null,o=!1,n=!0;if(f.load_from_url){var a=r().multifilter;if(a&&"null"!==a&&"undefined"!==a){var s=e(u).attr("id");if(s&&"null"!==s&&"undefined"!==s){var l=JSON.parse(decodeURI(a)),p=l[s];if(p&&"null"!==p&&"undefined"!==p){n=!1,t=p,delete l[s];var m=JSON.stringify(l),g=A(i.location.href,"multifilter",m);"?"==(g=g.replace(/multifilter={}(\&?)/i,"")).charAt(g.length-1)&&(g=g.substr(0,g.length-1)),i.history.replaceState(null,null,g)}}}}f.store_session&&n&&(t=JSON.parse(localStorage.getItem(c()+d))),t&&"null"!==t&&"undefined"!==t&&("pagination"==f.pagination&&(v=t.paged),""!==t.search&&"undefined"!==t.search&&void 0!==t.search?(x=t.search,h.searchField.val(x),o=!0):h.taxonomies.each(function(i,n){var a=Object.keys(t.taxonomies_terms)[i];if(e(n).data("taxonomy")==a){if(t.taxonomies_terms[a].length<1)return!0;e(n).find(".exopite-multifilter-filter-item").each(function(i,n){-1!==e.inArray(e(n).data("term"),t.taxonomies_terms[a])&&(e(n).addClass("active"),o=!0)})}}),void 0!==wp.hooks&&wp.hooks.doAction("ema-load-session",u),(v>1||o)&&k())}()})},e(function(){e(".exopite-multifilter-container").not("ajax-disabled").exopiteMultifilter()})}(jQuery,window,document);
