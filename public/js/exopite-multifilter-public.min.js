!function(e,t,i,o){"use strict";e.fn.exopiteMultifilter=function(o){var n={loadingFinishedText:"No More Posts Available"},a=function(t,i){return i.each(function(i,o){var n=e(o).data("taxonomy");t[n]={};var a=[];e(o).find(".active").each(function(t,i){a.push(e(i).data("term"))}),t[n]=a}),t},s=function(e){var t=e.attr("href"),i=/pages?\/(\d+)/g.exec(t);return i?i[1]:1},r=function(){var e={};return t.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,i,o){e[i]=o}),e},l=function(e,t,i,o,n){switch(t){case"out":e.stop(!0,!1).slideUp(500).css({opacity:0,transition:"opacity .5s"});break;case"in":e.stop(!0,!1).css({opacity:1,transition:"opacity .5s",height:"auto"}).slideDown(500).promise().then(function(){i&&void 0!==wp.hooks&&wp.hooks.doAction("ema-success-animation-end",o,n)})}},c=e.proxy(function(){return this.selector},this);return this.each(function(d,p){var f,u=p,h=(e.extend({},n,o),{filterItems:e(u).find(".exopite-multifilter-filter-item"),nowLoading:e(u).find(".exopite-multifilter-now-loading"),taxonomies:e(u).find(".exopite-multifilter-filter-taxonomy"),searchButton:e(u).find(".exopite-multifilter-filter-reset-search").find('button[type="submit"]'),searchField:e(u).find(".exopite-multifilter-filter-reset-search").find("form").find("input"),reset:e(u).find(".exopite-multifilter-filter-reset"),itemsContainer:e(u).find(".exopite-multifilter-items"),pagination:e(u).find(".exopite-multifilter-paginations"),loading:e(u).find(".exopite-multifilter-now-loading")}),m=!1,g=!1,v=1,w="",x=function(i,o){if(u===i&&"pagination"==o.pagination){var n=e(i).offset().top;if(!(n-e(t).scrollTop()>0))return e("#wpadminbar").length&&(n-=e("#wpadminbar").height()),n-=e("header nav").height(),e("html, body").animate({scrollTop:n},300),i}},k=function(){if(f.display_filter){var i={};f.taxonomies_terms=a(i,h.taxonomies)}h.searchField.length&&(f.search=w),f.paged=v,f.store_session&&localStorage.setItem(c()+d,JSON.stringify({taxonomies_terms:f.taxonomies_terms,paged:v,search:w})),e.ajax({cache:!1,type:"POST",url:wp_ajax.ajax_url,data:{action:"exopite_multifilter_get_posts",json:JSON.stringify(f)},beforeSend:function(){m=!0,void 0!==wp.hooks&&wp.hooks.doAction("ema-before-send",u,f),"pagination"!=f.pagination&&1!=v||l(h.itemsContainer,"out",!1,null,null),"infinite"!=f.pagination&&l(h.pagination,"out",!1,null,null),l(h.loading,"in",!1,null,null)},success:function(i){void 0!==wp.hooks&&wp.hooks.doAction("ema-success-top",u,f),l(h.loading,"out",!1,null,null);var o=e(i),n=o.find("article"),a=o.filter(".no-posts-found");if(n.length>0){var s=o.filter(".exopite-multifilter-paginations").children(":first"),r=h.itemsContainer.data("page")+"page/"+v+"/";"pagination"==f.pagination||1==v?(h.itemsContainer.html(n),"masonry"==f.style?e(h.itemsContainer).css({opacity:1,height:"auto",display:"flex"}):l(h.itemsContainer,"in"),void 0!==wp.hooks&&wp.hooks.doAction("ema-success-items-paginated",u,n),e(u).trigger("success-items-paginated.exopiteMultifilter",[u,n])):(f.display_page_number?n=e('<div class="page-number" data-page="'+r+'">'+v+"</div>").add(n):f.update_paged&&n.filter("article").first().attr("data-page",r),h.itemsContainer.append(n),void 0!==wp.hooks&&wp.hooks.doAction("ema-success-items-appended",u,n),e(u).trigger("success-items-appended.exopiteMultifilter",[u,n])),f.update_paged&&r!=t.location&&changeBrowserUrl(r),"infinite"!=f.pagination&&(h.pagination.html(s),l(h.pagination,"in",!0,u,f))}else"pagination"!=f.pagination&&1!=v||h.itemsContainer.empty(),h.pagination.html(a),l(h.itemsContainer,"in",!1,null,null),l(h.pagination,"in",!1,null,null),g=!0,setTimeout(function(){h.pagination.fadeOut("fast")},3e3);e(u).find(".nothing-more").length&&setTimeout(function(){h.pagination.fadeOut("fast")},3e3),void 0!==wp.hooks&&wp.hooks.doAction("ema-success-end",u,f),m=!1},error:function(e,t,i){void 0!==wp.hooks&&wp.hooks.doAction("ema-error",u),console.log("Error: "+e.responseText),console.log("Error: "+e),console.log("Error: "+t),console.log("Error: "+i),m=!1}})},y=function(){!m&&!g&&"infinite"==f.pagination&&e(t).scrollTop()>=e(h.itemsContainer).children().last().offset().top+e(h.itemsContainer).children().last().outerHeight()-t.innerHeight&&(v++,void 0!==wp.hooks&&wp.hooks.doAction("ema-bottom-reached",u),k())},_=Exopite.throttle(function(){"infinite"==f.pagination&&y(),f.update_paged&&e("[data-page]").each(function(i,o){var n=e(o).data("page");if(isElementInViewport(o)){if(t.location.href==n)return;changeBrowserUrl(n)}})},100);e(i).on("scroll",_);var b=function(e){switch(g=!1,v=1,w="","search"!=e&&h.searchField.val(""),e){case"search":w=h.searchField.val();case"reset":h.filterItems.removeClass("active")}};h.searchButton.on("click",function(e){e.preventDefault(),m||""!==h.searchField.val()&&(b("search"),void 0!==wp.hooks&&wp.hooks.doAction("ema-search",u,h.searchField.val()),k())}),h.reset.on("click",function(e){e.preventDefault(),m||(b("reset"),void 0!==wp.hooks&&wp.hooks.doAction("ema-reset",u),k())}),h.filterItems.on("click",function(t){if(t.preventDefault(),!m){if(void 0!==wp.hooks&&wp.hooks.doAction("ema-filter-selected",u),f.multi_selectable)b(),e(this).toggleClass("active");else{var i=e(this).hasClass("active");b("reset"),i||e(this).addClass("active")}k()}}),h.pagination.on("click",".page-numbers, .btn-readmore",function(t){t.preventDefault(),m||(v=s(e(this)),void 0!==wp.hooks&&wp.hooks.doAction("ema-pagination",u),k())}),f=e(u).data("ajax"),e(u).attr("data-index",d),void 0!==wp.hooks&&wp.hooks.addAction("ema-before-send",x,10);var A=function(e,t,i){var o=new RegExp("(\\?|\\&)("+t+"=).*?(&|$)"),n=e;return n=e.search(o)>=0?e.replace(o,"$1$2"+i+"$3"):n+(n.indexOf("?")>0?"&":"?")+t+"="+i};(f.store_session||f.load_from_url)&&function(){var i=null,o=!1,n=!0;if(f.load_from_url){var a=r().multifilter;if(a&&"null"!==a&&"undefined"!==a){var s=e(u).attr("id");if(s&&"null"!==s&&"undefined"!==s){var l=JSON.parse(decodeURI(a)),p=l[s];if(p&&"null"!==p&&"undefined"!==p){n=!1,i=p,delete l[s];var m=JSON.stringify(l),g=A(t.location.href,"multifilter",m);"?"==(g=g.replace(/multifilter={}(\&?)/i,"")).charAt(g.length-1)&&(g=g.substr(0,g.length-1)),t.history.replaceState(null,null,g)}}}}f.store_session&&n&&(i=JSON.parse(localStorage.getItem(c()+d))),i&&"null"!==i&&"undefined"!==i&&("pagination"==f.pagination&&(v=i.paged),""!==i.search&&"undefined"!==i.search&&void 0!==i.search?(w=i.search,h.searchField.val(w),o=!0):h.taxonomies.each(function(t,n){var a=Object.keys(i.taxonomies_terms)[t];if(e(n).data("taxonomy")==a){if(i.taxonomies_terms[a].length<1)return!0;e(n).find(".exopite-multifilter-filter-item").each(function(t,n){-1!==e.inArray(e(n).data("term"),i.taxonomies_terms[a])&&(e(n).addClass("active"),o=!0)})}}),void 0!==wp.hooks&&wp.hooks.doAction("ema-load-session",u),(v>1||o)&&k())}()})},e(function(){e(".exopite-multifilter-container").exopiteMultifilter()})}(jQuery,window,document);
