!function(a,b,c,d){"use strict";a.fn.exopiteMultifilter=function(e){var f={loadingFinishedText:"No More Posts Available"},g=function(c,d){return d.each(function(b,d){var e=a(d).data("taxonomy");c[e]={};var f=[];a(d).find(".active").each(function(b,c){f.push(a(c).data("term"))}),c[e]=f}),c},h=function(b){var c=b.attr("href"),d=/pages?\/(\d+)/g,e=d.exec(c);return e?e[1]:1},i=function(b,c){switch(c){case"out":b.stop(!0,!1).slideUp(500).css({opacity:0,transition:"opacity .5s"});break;case"in":b.stop(!0,!1).css({opacity:1,transition:"opacity .5s",height:"auto"}).slideDown(500)}},j=a.proxy(function(){return this.selector},this);return this.each(function(k,l){var t,m=l,o=(a.extend({},f,e),{filterItems:a(m).find(".exopite-multifilter-filter-item"),nowLoading:a(m).find(".exopite-multifilter-now-loading"),taxonomies:a(m).find(".exopite-multifilter-filter-taxonomy"),searchButton:a(m).find(".exopite-multifilter-filter-reset-search").find('button[type="submit"]'),searchField:a(m).find(".exopite-multifilter-filter-reset-search").find("form").find("input"),reset:a(m).find(".exopite-multifilter-filter-reset"),itemsContainer:a(m).find(".exopite-multifilter-items"),pagination:a(m).find(".exopite-multifilter-paginations"),loading:a(m).find(".exopite-multifilter-now-loading")}),p=!1,q=!1,r=1,s="",u=function(c,d){if(m===c&&"pagination"==d.pagination){var e=a(c).offset().top;if(!(e-a(b).scrollTop()>0))return a("#wpadminbar").length&&(e-=a("#wpadminbar").height()),e-=a("header nav").height(),a("html, body").animate({scrollTop:e},300),c}},v=function(){t=a(m).data("ajax"),a(m).attr("data-index",k),"undefined"!=typeof wp.hooks&&wp.hooks.addAction("ema-success-end",u,10)},w=function(){if(t.display_filter){var d={};t.taxonomies_terms=g(d,o.taxonomies)}o.searchField.length&&(t.search=s),t.paged=r,t.store_session&&localStorage.setItem(j()+k,JSON.stringify({taxonomies_terms:t.taxonomies_terms,paged:r,search:s})),a.ajax({cache:!1,type:"POST",url:wp_ajax.ajax_url,data:{action:"exopite_multifilter_get_posts",json:JSON.stringify(t)},beforeSend:function(){p=!0,"undefined"!=typeof wp.hooks&&wp.hooks.doAction("ema-before-send",m),"pagination"!=t.pagination&&1!=r||i(o.itemsContainer,"out"),"infinite"!=t.pagination&&i(o.pagination,"out"),i(o.loading,"in")},success:function(c){"undefined"!=typeof wp.hooks&&wp.hooks.doAction("ema-success-top",m),i(o.loading,"out");var d=a(c),e=d.find("article"),f=d.filter(".no-posts-found");if(e.length>0){var g=d.filter(".exopite-multifilter-paginations").children(":first"),h=o.itemsContainer.data("page")+"page/"+r+"/";if("pagination"==t.pagination||1==r)o.itemsContainer.html(e),i(o.itemsContainer,"in");else{if(t.display_page_number){var j=a('<div class="page-number" data-page="'+h+'">'+r+"</div>");e=j.add(e)}else t.update_paged&&e.filter("article").first().attr("data-page",h);o.itemsContainer.append(e)}t.update_paged&&h!=b.location&&changeBrowserUrl(h),"infinite"!=t.pagination&&(o.pagination.html(g),i(o.pagination,"in"))}else"pagination"!=t.pagination&&1!=r||o.itemsContainer.empty(),o.pagination.html(f),i(o.itemsContainer,"in"),i(o.pagination,"in"),setTimeout(function(){q&&o.pagination.fadeOut("fast")},3e3),q=!0;p=!1,"undefined"!=typeof wp.hooks&&wp.hooks.doAction("ema-success-end",m,t)},error:function(a,b,c){"undefined"!=typeof wp.hooks&&wp.hooks.doAction("ema-error",m),console.log("Error: "+a.responseText),console.log("Error: "+a),console.log("Error: "+b),console.log("Error: "+c),p=!1}})},x=function(){!p&&!q&&"infinite"==t.pagination&&a(b).scrollTop()>=a(o.itemsContainer).children().last().offset().top+a(o.itemsContainer).children().last().outerHeight()-b.innerHeight&&(r++,"undefined"!=typeof wp.hooks&&wp.hooks.doAction("ema-bottom-reached",m),w())},y=Exopite.throttle(function(){"infinite"==t.pagination&&x(),t.update_paged&&a("[data-page]").each(function(c,d){var e=a(d).data("page");if(isElementInViewport(d)){if(b.location.href==e)return;changeBrowserUrl(e)}})},100);a(c).on("scroll",y);var z=function(b){switch(q=!1,r=1,s="","search"!=b&&o.searchField.val(""),b){case"search":s=o.searchField.val();case"reset":o.filterItems.removeClass("active")}};o.searchButton.on("click",function(a){a.preventDefault(),p||""!==o.searchField.val()&&(z("search"),"undefined"!=typeof wp.hooks&&wp.hooks.doAction("ema-search",m),w())}),o.reset.on("click",function(a){a.preventDefault(),p||(z("reset"),"undefined"!=typeof wp.hooks&&wp.hooks.doAction("ema-reset",m),w())}),o.filterItems.on("click",function(b){if(b.preventDefault(),!p){if("undefined"!=typeof wp.hooks&&wp.hooks.doAction("ema-filter-selected",m),t.multi_selectable)z(),a(this).toggleClass("active");else{var c=a(this).hasClass("active");z("reset"),c||a(this).addClass("active")}w()}}),o.pagination.on("click",".page-numbers, .btn-readmore",function(b){b.preventDefault(),p||(r=h(a(this)),"undefined"!=typeof wp.hooks&&wp.hooks.doAction("ema-pagination",m),w())}),v();var A=function(){var c=JSON.parse(localStorage.getItem(j()+k)),e=!1;c&&"null"!==c&&"undefined"!==c&&("pagination"==t.pagination&&(r=c.paged),""!==c.search&&"undefined"!==c.search&&c.search!==d&&(s=c.search,o.searchField.val(s),e=!0),o.taxonomies.each(function(b,d){var f=Object.keys(c.taxonomies_terms)[b];if(a(d).data("taxonomy")==f){if(c.taxonomies_terms[f].length<1)return!0;a(d).find(".exopite-multifilter-filter-item").each(function(b,d){a.inArray(a(d).data("term"),c.taxonomies_terms[f])!==-1&&(a(d).addClass("active"),e=!0)})}}),"undefined"!=typeof wp.hooks&&wp.hooks.doAction("ema-load-session",m),(r>1||e)&&w())};t.store_session&&A()})},a(function(){a(".exopite-multifilter-container").exopiteMultifilter()})}(jQuery,window,document);
