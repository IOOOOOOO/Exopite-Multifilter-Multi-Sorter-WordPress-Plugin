!function(e,t,i,o){"use strict";e.fn.exopiteMultifilter=function(o){var n={loadingFinishedText:"No More Posts Available"},a=function(t,i){return i.each(function(i,o){var n=e(o).data("taxonomy");t[n]={};var a=[];e(o).find(".active").each(function(t,i){a.push(e(i).data("term"))}),t[n]=a}),t},r=function(e){var t=e.attr("href"),i=/pages?\/(\d+)/g.exec(t);return i?i[1]:1},s=function(){var e={};return t.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,i,o){e[i]=o}),e},l=function(e,t){switch(t){case"out":e.stop(!0,!1).slideUp(500).css({opacity:0,transition:"opacity .5s"});break;case"in":e.stop(!0,!1).css({opacity:1,transition:"opacity .5s",height:"auto"}).slideDown(500)}},c=e.proxy(function(){return this.selector},this);return this.each(function(d,f){var p,u=f,h=(e.extend({},n,o),{filterItems:e(u).find(".exopite-multifilter-filter-item"),nowLoading:e(u).find(".exopite-multifilter-now-loading"),taxonomies:e(u).find(".exopite-multifilter-filter-taxonomy"),searchButton:e(u).find(".exopite-multifilter-filter-reset-search").find('button[type="submit"]'),searchField:e(u).find(".exopite-multifilter-filter-reset-search").find("form").find("input"),reset:e(u).find(".exopite-multifilter-filter-reset"),itemsContainer:e(u).find(".exopite-multifilter-items"),pagination:e(u).find(".exopite-multifilter-paginations"),loading:e(u).find(".exopite-multifilter-now-loading")}),m=!1,g=!1,v=1,x="",w=function(i,o){if(u===i&&"pagination"==o.pagination){var n=e(i).offset().top;if(!(n-e(t).scrollTop()>0))return e("#wpadminbar").length&&(n-=e("#wpadminbar").height()),n-=e("header nav").height(),e("html, body").animate({scrollTop:n},300),i}},k=function(){if(p.display_filter){var i={};p.taxonomies_terms=a(i,h.taxonomies)}h.searchField.length&&(p.search=x),p.paged=v,p.store_session&&localStorage.setItem(c()+d,JSON.stringify({taxonomies_terms:p.taxonomies_terms,paged:v,search:x})),e.ajax({cache:!1,type:"POST",url:wp_ajax.ajax_url,data:{action:"exopite_multifilter_get_posts",json:JSON.stringify(p)},beforeSend:function(){m=!0,void 0!==wp.hooks&&wp.hooks.doAction("ema-before-send",u),"pagination"!=p.pagination&&1!=v||l(h.itemsContainer,"out"),"infinite"!=p.pagination&&l(h.pagination,"out"),l(h.loading,"in")},success:function(i){void 0!==wp.hooks&&wp.hooks.doAction("ema-success-top",u),l(h.loading,"out");var o=e(i),n=o.find("article"),a=o.filter(".no-posts-found");if(n.length>0){var r=o.filter(".exopite-multifilter-paginations").children(":first"),s=h.itemsContainer.data("page")+"page/"+v+"/";"pagination"==p.pagination||1==v?(h.itemsContainer.html(n),l(h.itemsContainer,"in")):(p.display_page_number?n=e('<div class="page-number" data-page="'+s+'">'+v+"</div>").add(n):p.update_paged&&n.filter("article").first().attr("data-page",s),h.itemsContainer.append(n)),p.update_paged&&s!=t.location&&changeBrowserUrl(s),"infinite"!=p.pagination&&(h.pagination.html(r),l(h.pagination,"in"))}else"pagination"!=p.pagination&&1!=v||h.itemsContainer.empty(),h.pagination.html(a),l(h.itemsContainer,"in"),l(h.pagination,"in"),setTimeout(function(){g&&h.pagination.fadeOut("fast")},3e3),g=!0;m=!1,void 0!==wp.hooks&&wp.hooks.doAction("ema-success-end",u,p)},error:function(e,t,i){void 0!==wp.hooks&&wp.hooks.doAction("ema-error",u),console.log("Error: "+e.responseText),console.log("Error: "+e),console.log("Error: "+t),console.log("Error: "+i),m=!1}})},_=function(){!m&&!g&&"infinite"==p.pagination&&e(t).scrollTop()>=e(h.itemsContainer).children().last().offset().top+e(h.itemsContainer).children().last().outerHeight()-t.innerHeight&&(v++,void 0!==wp.hooks&&wp.hooks.doAction("ema-bottom-reached",u),k())},y=Exopite.throttle(function(){"infinite"==p.pagination&&_(),p.update_paged&&e("[data-page]").each(function(i,o){var n=e(o).data("page");if(isElementInViewport(o)){if(t.location.href==n)return;changeBrowserUrl(n)}})},100);e(i).on("scroll",y);var b=function(e){switch(g=!1,v=1,x="","search"!=e&&h.searchField.val(""),e){case"search":x=h.searchField.val();case"reset":h.filterItems.removeClass("active")}};h.searchButton.on("click",function(e){e.preventDefault(),m||""!==h.searchField.val()&&(b("search"),void 0!==wp.hooks&&wp.hooks.doAction("ema-search",u),k())}),h.reset.on("click",function(e){e.preventDefault(),m||(b("reset"),void 0!==wp.hooks&&wp.hooks.doAction("ema-reset",u),k())}),h.filterItems.on("click",function(t){if(t.preventDefault(),!m){if(void 0!==wp.hooks&&wp.hooks.doAction("ema-filter-selected",u),p.multi_selectable)b(),e(this).toggleClass("active");else{var i=e(this).hasClass("active");b("reset"),i||e(this).addClass("active")}k()}}),h.pagination.on("click",".page-numbers, .btn-readmore",function(t){t.preventDefault(),m||(v=r(e(this)),void 0!==wp.hooks&&wp.hooks.doAction("ema-pagination",u),k())}),p=e(u).data("ajax"),e(u).attr("data-index",d),void 0!==wp.hooks&&wp.hooks.addAction("ema-success-end",w,10);var C=function(e,t,i){var o=new RegExp("(\\?|\\&)("+t+"=).*?(&|$)"),n=e;return n=e.search(o)>=0?e.replace(o,"$1$2"+i+"$3"):n+(n.indexOf("?")>0?"&":"?")+t+"="+i};(p.store_session||p.load_from_url)&&function(){var i=null,o=!1,n=!0;if(p.load_from_url){var a=s().multifilter;if(a&&"null"!==a&&"undefined"!==a){var r=e(u).attr("id");if(r&&"null"!==r&&"undefined"!==r){var l=JSON.parse(decodeURI(a)),f=l[r];if(f&&"null"!==f&&"undefined"!==f){n=!1,i=f,delete l[r];var m=JSON.stringify(l),g=C(t.location.href,"multifilter",m);"?"==(g=g.replace(/multifilter={}(\&?)/i,"")).charAt(g.length-1)&&(g=g.substr(0,g.length-1)),t.history.replaceState(null,null,g)}}}}p.store_session&&n&&(i=JSON.parse(localStorage.getItem(c()+d))),i&&"null"!==i&&"undefined"!==i&&("pagination"==p.pagination&&(v=i.paged),""!==i.search&&"undefined"!==i.search&&void 0!==i.search?(x=i.search,h.searchField.val(x),o=!0):h.taxonomies.each(function(t,n){var a=Object.keys(i.taxonomies_terms)[t];if(e(n).data("taxonomy")==a){if(i.taxonomies_terms[a].length<1)return!0;e(n).find(".exopite-multifilter-filter-item").each(function(t,n){-1!==e.inArray(e(n).data("term"),i.taxonomies_terms[a])&&(e(n).addClass("active"),o=!0)})}}),void 0!==wp.hooks&&wp.hooks.doAction("ema-load-session",u),(v>1||o)&&k())}()})},e(function(){e(".exopite-multifilter-container").exopiteMultifilter()})}(jQuery,window,document);
